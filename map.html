<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genre and Artist Network</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.4/d3.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #121212;
            color: #fff;
            overflow: hidden;
        }
        svg {
            display: block;
        }
    </style>
</head>
<body>
    <script>
        const jsonUrl = "https://phonkdex.com/tree-data/tree.json";

        fetch(jsonUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
    const width = window.innerWidth;
    const height = window.innerHeight;

    // Add missing nodes dynamically
    const allNodes = new Set(data.nodes.map(node => node.id));
    data.links.forEach(link => {
        if (!allNodes.has(link.source)) {
            data.nodes.push({ id: link.source, group: 0 }); // Add placeholder node
            allNodes.add(link.source);
        }
        if (!allNodes.has(link.target)) {
            data.nodes.push({ id: link.target, group: 0 }); // Add placeholder node
            allNodes.add(link.target);
        }
    });

    const svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

    const container = svg.append("g");

    // Add background stars
    const starCount = 200;
    for (let i = 0; i < starCount; i++) {
        svg.append("circle")
            .attr("cx", Math.random() * width)
            .attr("cy", Math.random() * height)
            .attr("r", Math.random() * 2)
            .attr("fill", "#fff")
            .attr("opacity", 0.5);
    }

    const zoom = d3.zoom()
        .scaleExtent([0.5, 2])
        .on("zoom", (event) => {
            container.attr("transform", event.transform);
        });

    svg.call(zoom);

    const simulation = d3.forceSimulation(data.nodes)
        .force("link", d3.forceLink(data.links).id(d => d.id).distance(150))
        .force("charge", d3.forceManyBody().strength(-500))
        .force("center", d3.forceCenter(width / 2, height / 2));

    const link = container.append("g")
        .attr("class", "links")
        .selectAll("line")
        .data(data.links)
        .enter().append("line")
        .attr("stroke", "#999")
        .attr("stroke-opacity", 0.6)
        .attr("stroke-width", 1.5);

    const node = container.append("g")
        .attr("class", "nodes")
        .selectAll("circle")
        .data(data.nodes)
        .enter().append("circle")
        .attr("r", d => d.id === "Phonk" ? 12 : 8) // Larger radius for "Phonk"
        .attr("fill", d => d.id === "Phonk" ? "#ff6f61" : (d.group === 1 ? "#fff" : "#000"))
        .call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended));

    const label = container.append("g")
        .attr("class", "labels")
        .selectAll("text")
        .data(data.nodes)
        .enter().append("text")
        .text(d => d.id)
        .attr("x", 10)
        .attr("y", 3)
        .style("fill", "#fff")
        .style("font-size", "12px")
        .style("pointer-events", "none");

    simulation.nodes(data.nodes).on("tick", ticked);
    simulation.force("link").links(data.links);

    function ticked() {
        link
            .attr("x1", d => d.source.x)
            .attr("y1", d => d.source.y)
            .attr("x2", d => d.target.x)
            .attr("y2", d => d.target.y);

        node
            .attr("cx", d => d.x)
            .attr("cy", d => d.y);

        label
            .attr("x", d => d.x + 10)
            .attr("y", d => d.y + 3);
    }

    function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }

    function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
    }

    function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        if (d.id !== "Phonk") { // Prevent "Phonk" from being draggable
            d.fx = null;
            d.fy = null;
        }
    }
})
.catch(error => console.error('Error loading JSON data:', error));

    </script>
</body>
</html>
